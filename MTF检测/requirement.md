# 8 MTF检测:  
测试图像:MTF刃边图  
1)投影光机和相机均置于成像测试工装台架:  
2)光机镜头出光面与相机镜头外入光面的夹角控制在2°以内，用水平仪等工具调整光机与成像屏幕至垂直状态;  
3)投影1152/8线对图调整曝光量将双目相机调整至信号强度80%以上，然后调整相机焦距使信号强度至最大值，    
此时为对焦清晰:  
4)点亮光机，调节光机输入额定功率，并将光机投影图案设置为MTF刃边图，至热稳定状态;  
5)相机拍摄幕布上的图案，定义中心点至四角距离为100%视场，分别取0/0.3/0.5/0.7/0.85(0.85视场不考核)视场，  
每个视场对应方形白图如图中所示， 分别计算出每个方形白图子午和弧矢方向，子午和弧矢方向的MTF取两边的均值:  
MTF子午 = 1/2(MTF子午左+MTF子午右)    
MTF弧矢 = 1/2(MTF弧矢上+MTF弧矢下)    
每个视场的MTF取为该视场中子午和弧矢方向MTF的最小值，如0.3视场的MTF0.3F=min(MTF0.3F子午，MTF0.3F弧矢):  
6)算出每个视场的MTF，并与判据比较。

## 方案步骤：根据你的描述，8 MTF检测的具体步骤如下：

1. **准备工作**：
   - 将投影光机和相机均置于成像测试工装台架上。
   - 确保光机镜头出光面与相机镜头外入光面的夹角控制在2°以内，并使用水平仪等工具调整光机与成像屏幕至垂直状态。

2. **调整光机和相机**：
   - 使用1152/8线对图调整曝光量，将双目相机调整至信号强度80%以上。
   - 调整相机焦距，使信号强度达到最大值，此时为对焦清晰状态。

3. **设定投影图案和热稳定**：
   - 点亮光机，调节光机输入额定功率。
   - 将光机投影图案设置为MTF刃边图，等待至光机达到热稳定状态。

4. **拍摄和视场划分**：
   - 相机拍摄幕布上的图案。
   - 定义中心点至四角的距离为100%视场，分别取0%、30%、50%、70%、85%视场（0.85视场不考核）。
   - 对每个视场对应的方形白图进行标注和划分。

5. **计算MTF**：
   - 计算每个方形白图的子午方向（MTF子午）和弧矢方向（MTF弧矢）的MTF值。
   - MTF子午=1/2(MTF子午左+MTF子午右)
   - MTF弧矢=1/2(MTF弧矢上+MTF弧矢下)
   - 每个视场的MTF取该视场中子午和弧矢方向MTF的最小值，即MTF视场=min(MTF视场子午, MTF视场弧矢)。

6. **结果判定**：
   - 算出每个视场的MTF值，并将其与判据进行比较。

通过这些步骤，可以系统地评估光学系统在不同视场位置的成像质量和对比度传递能力，进而验证其性能是否满足要求。  


为了计算和评估MTF，以下是一个详细的算法方案。这个算法将分成几个主要步骤，包括图像采集、预处理、MTF计算和结果分析。

### 步骤 1：图像采集
1. **初始化设备**：
   - 将投影光机和相机置于成像测试工装台架上。
   - 调整光机和相机的位置，使光机镜头出光面与相机镜头外入光面的夹角控制在2°以内，并确保光机与成像屏幕垂直。

2. **调整曝光和焦距**：
   - 投影1152/8线对图，调整相机的曝光量，使信号强度达到80%以上。
   - 调整相机焦距，使信号强度达到最大值，对焦清晰。

3. **设置投影图案**：
   - 点亮光机，调整输入额定功率。
   - 设置光机投影图案为MTF刃边图，并等待至光机达到热稳定状态。

### 步骤 2：图像预处理
1. **图像采集**：
   - 使用相机拍摄幕布上的MTF刃边图图案。
   - 测试光源：MTF 测试中常用三种发光体：点，狭缝，刃边。以下将逐一介绍如何用这三种光源。

2. **图像分割**：
   - 根据中心点至四角的距离，划分为不同的视场：0%、30%、50%、70%、85%（85%视场不考核）。
   - 在每个视场内，选取代表性的方形白图。

### 步骤 3：MTF计算
1. **计算对比度**：
   - 对每个视场内的方形白图，提取子午方向和弧矢方向的边缘。
   - 使用对比度公式计算输入和输出的对比度：
     \[
     C = \frac{I_{\text{max}} - I_{\text{min}}}{I_{\text{max}} + I_{\text{min}}}
     \]

2. **计算MTF**：  
   - 对每个子午方向和弧矢方向，计算MTF值：  
     \[
     MTF = \frac{C_{\text{out}}}{C_{\text{in}}}
     \]
   - 子午方向MTF取两边的均值：  
     \[
     MTF_{\text{子午}} = \frac{1}{2}(MTF_{\text{子午左}} + MTF_{\text{子午右}})
     \]
   - 弧矢方向MTF取两边的均值：  
     \[
     MTF_{\text{弧矢}} = \frac{1}{2}(MTF_{\text{弧矢上}} + MTF_{\text{弧矢下}})
     \]

3. **视场MTF计算**：
   - 每个视场的MTF取子午和弧矢方向MTF的最小值：  
     \[
     MTF_{\text{视场}} = \min(MTF_{\text{视场子午}}, MTF_{\text{视场弧矢}})
     \]

### 步骤 4：结果分析与判定
1. **结果汇总**：
   - 汇总每个视场的MTF值。

2. **结果判定**：
   - 将计算得到的MTF值与设定的判据进行比较，判断光学系统是否符合要求。

### 代码示例
下面是一个基于Python的简化代码示例，演示如何实现上述算法。实际使用中，需要根据具体情况进行调整和优化。

```python
import cv2
import numpy as np

def calculate_contrast(image):
    I_max = np.max(image)
    I_min = np.min(image)
    contrast = (I_max - I_min) / (I_max + I_min)
    return contrast

def calculate_mtf(C_in, C_out):
    return C_out / C_in

def main():
    # 假设已经采集到了图像
    image = cv2.imread('mtf_image.png', 0)
    
    # 对图像进行预处理（如裁剪、分割）
    # 分割为不同的视场
    fields = [crop_image(image, field_coords) for field_coords in field_coords_list]
    
    mtf_values = []
    for field in fields:
        # 提取子午方向和弧矢方向的边缘
        C_in = calculate_contrast(original_pattern)  # 输入对比度
        C_out_meridional = calculate_contrast(field_meridional)  # 子午方向输出对比度
        C_out_sagittal = calculate_contrast(field_sagittal)  # 弧矢方向输出对比度
        
        MTF_meridional = calculate_mtf(C_in, C_out_meridional)
        MTF_sagittal = calculate_mtf(C_in, C_out_sagittal)
        
        MTF_field = min(MTF_meridional, MTF_sagittal)
        mtf_values.append(MTF_field)
    
    # 结果判定
    for i, mtf in enumerate(mtf_values):
        print(f"Field {i}: MTF = {mtf}")

if __name__ == "__main__":
    main()
```

以上代码是一个简化示例，具体实现中需要加入更多的图像处理步骤，如边缘检测、滤波等。希望这能为你提供一个基本框架，帮助你设计和实现MTF检测算法。

## 参考文档
https://www.cnblogs.com/wxl845235800/p/9260090.html